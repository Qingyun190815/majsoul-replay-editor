# 赤羽之战模式

活动场对应 `mode_id` 是 41, 关键词是 `chuanma`

## 规则说明

- 使用的麻将牌没有字牌, 总计108张
- 配牌后选择3张同花色的牌, 与其他雀士交换
- 每局需要选择一种不需要的花色, 牌型中没有此花色的牌才可以和牌
- 不能立直和吃牌, 没有振听, 沒有王牌及宝牌
- 每一局的结束条件从有1人和牌变为有3人和牌
- 不设连庄, 对战4局后结束, 每局第一位和牌的雀士, 在下一局为东风位
- 发生和牌时, 点数实时结算, 手牌不公开, 如果雀士被飞则对局结束
- 一局结束后, 如果和牌人数小于3人, 视为流局
- 暗杠时, 向所有场上雀士收取2000点
- 大明杠时, 向打出杠牌的雀士收取2000点
- 使用摸到的牌补杠时, 向所有场上雀士收取1000点
- 使用手牌补杠时, 不向其他雀士收取点数
- 补杠时如果发生抢杠, 此杠不成立, 不向其他雀士收取点数
- 流局时, 如果未听牌, 对局过程中通过杠牌收取的点数会原数返还给其他雀士
- 同一局内, 已和牌的雀士不参与以下流局结算
    - 流局时, 未听牌的雀士需要支付给已听牌的雀士点数, 按照其听牌的可能最大番数计算
    - 流局时, 如果手牌里还有不需要的花色, 需要支付给其他雀士(无论听牌与否)每人4番起的点数, 如果听牌的可能最大番数超过4番,
      则按照此听牌番数计算
- 和牌时番数与点数的关系：
    - 1番 = 1000点
    - 2番 = 2000点
    - 3番 = 4000点
    - 4番 = 8000点
    - 5番 = 16000点
    - 6番 = 32000点 (封顶)
- 荣和时, 向放铳玩家收取对应点数
- 自摸和牌时, 向场上所有玩家收取对应点数, 并额外增加1000点
- 各家起始点数 50000

## 函数特殊说明

### 换三张换牌(修罗之战/川麻): `huansanzhang(tiles0, tiles1, tiles2, tiles3, type)`

`tiles0, tiles1, tiles2, tiles3` : 表示四个人要交出去的三张牌

`type` : 0 表示逆时针换牌, 1 表示对家换牌, 2 表示顺时针换牌

例子: `huansanzhang("9p79s", "333s", "78p8s", "333z", 1);`

### 和牌(修罗之战/川麻): `hupai(allseats, type)`

与段位场相比多了个参数 `type`, 值为 false 表示中途和牌, true 表示最终和牌, 默认为 false

例子: `hupai([0, 2, 3], true);` 和 `hupai(1);`

### 定缺: `dingque(gaps)`

`gaps` : 表示所有人的定缺花色, 四个字母从前到后分别代表 `seat` 从 0 到 3 的四名玩家

例子: `dingque("smps")`

### 对局结束 `gameend()`

如果"血战到底"的模式的最后一局不是流局的话, 需要在牌谱文件的最后加一个 `gameend();` 表示对局结束, 否则最后会跳过最后一位玩家的和牌展示

# template.js: 赤羽之战(川麻)报菜名合集

## 赤羽之战番种一览

| 序号 |    番名     | 番数 |
|:--:|:---------:|:--:|
| 1  |    底和     | 1  |
| 2  | 奖励役: 杠上花  | 1  |
| 3  | 奖励役: 杠上炮  | 1  |
| 4  |  奖励役: 抢杠  | 1  |
| 5  | 奖励役: 海底捞月 | 1  |
| 6  |  奖励役: 根   | 1  |
| 7  |    对对和    | 2  |
| 8  |    清一色    | 3  |
| 9  |    七对子    | 3  |
| 10 |    带幺九    | 3  |
| 11 |    金钩钓    | 3  |
| 12 |    清对     | 4  |
| 13 |    将对     | 4  |
| 14 |    龙七对    | 4  |
| 15 |    清七对    | 5  |
| 16 |    清幺九    | 5  |
| 17 |   清金钩钓    | 5  |
| 18 |    天和     | 6  |
| 19 |    地和     | 6  |
| 20 |   清龙七对    | 6  |
| 21 |   十八罗汉    | 6  |
| 22 |   清十八罗汉   | 6  |

## 语音目录

另加一个雀魂中没有的"诈和示范"

|  番名   | 第一次出现部分 |           备注           |
|:-----:|:-------:|:----------------------:|
|  底和   |    6    |          没有语音          |
|  杠上花  |    1    |        语音同 岭上开花        |
|  杠上炮  |    1    |
|  抢杠   |    3    |         语音同 枪杠         |
| 海底捞月  |    6    | 语音同 海底摸月<br> 且不区分海底和河底 |
|   根   |    1    |
|  对对和  |    6    |        语音同 对对和         |
|  清一色  |    5    |        语音同 清一色         |
|  七对子  |    5    |        语音同 七对子         |
|  带幺九  |    5    |
|  金钩钓  |    4    |
|  清对   |    4    |
|  将对   |    4    |
|  龙七对  |    3    |
|  清七对  |    3    |
|  清幺九  |    3    |
| 清金钩钓  |    1    |
|  天和   |    1    |         语音同 天和         |
|  地和   |    2    |         语音同 地和         |
| 清龙七对  |    2    |
| 十八罗汉  |    2    |
| 清十八罗汉 |    1    |
|       |         |
| 诈和示范  |    7    |

## 小局细节

只有那五个奖励役可以和其他番种复合, 所以虽然番种不多, 但仍需要6局才能报完

为方便编辑, 牌谱没有换三张的过程

---

第1局: 天和, 根; 清十八罗汉, 杠上花; 清金钩钓, 杠上炮

---

第2局: 地和; 清龙七对; 十八罗汉

---

第3局: 清七对; 清幺九, 抢杠; 龙七对

---

第4局: 将对; 清对; 金钩钓

---

第5局: 带幺九; 七对子; 清一色

---

第6局: 对对; 底和, 海底捞月

---

第7局: 诈和示范

## 其他: 川麻规则番种的另一种解释方式(自创)

把"底和"看成"底番", 属性不变, 除此之外的番种都看成是附加的, 故番数可能要有变化, 除奖励番外番数普遍都减1

其他番种又可以分为"基础番种"和"复合番种", 基础番种如下

| 序号 |  番名  | 番数 |        备注         |
|:--:|:----:|:--:|:-----------------:|
| 1  | 杠上花  | 1  |     奖励番, 一定有根     |
| 2  | 杠上炮  | 1  |        奖励番        |
| 3  |  抢杠  | 1  |        奖励番        |
| 4  | 海底捞月 | 1  |        奖励番        |
| 5  |  根   | 1  |        奖励番        |
| 6  | 对对和  | 1  |
| 7  | 清一色  | 2  |
| 8  | 七对子  | 2  |
| 9  | 带幺九  | 2  |
| 10 | 金钩钓  | 1  | 一定有对对和, 这1番是在其基础上 |
| 11 |  将对  | 2  | 一定有对对和, 这2番是在其基础上 |
| 12 |  天和  | 5  |
| 13 |  地和  | 5  |

"复合番种"都可以看成是由"基础番种"复合而来的

| 序号 |  番名   | 番数 |            构成            |           备注           |
|:--:|:-----:|:--:|:------------------------:|:----------------------:|
| 1  |  清对   | 3  |       对对和+清一色, 1+2       |
| 2  |  龙七对  | 3  |        七对子+根, 2+1        |
| 3  |  清七对  | 4  |       七对子+清一色, 2+2       |
| 4  |  清幺九  | 4  |       清一色+带幺九, 2+2       |
| 5  | 清金钩钓  | 4  |    清一色+对对和+金钩钓, 2+1+1    |
| 6  | 清龙七对  | 5  |     七对子+根+清一色,2+1+2      |
| 7  | 十八罗汉  | 6  |    对对和+金钩钓+根*4, 1+1+4    | 加上底和是7番, 故赤羽规则下这个番种亏1番 |
| 8  | 清十八罗汉 | 8  | 对对和+金钩钓+清一色+根*4, 1+1+2+4 | 加上底和是9番, 故赤羽规则下这个番种亏3番 |

这样的话, 算上底和, 最高番数是 天和, 清七对, 根3, 如`22223333444455p`, 13番

不考虑天地和的话, 最高番数是 花天月地清十八罗汉, 如 `55p 22222p33333p77777p88888p`, 11番
