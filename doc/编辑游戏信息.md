# 编辑游戏信息 (game)

## 玩家信息 `editdata.player_datas`

`editdata.player_datas` 存储四个玩家的数据, 包括昵称, 头像框, 使用角色, 段位等信息

常用的是 `nickname`(昵称) 和 `avatar_id`(皮肤, 同时也修改了角色)

例子:

```js
editdata.player_datas[0].nickname = "电脑0";
editdata.player_datas[1].nickname = "电脑1";
editdata.player_datas[2].nickname = "电脑2";
editdata.player_datas[3].nickname = "电脑3";
editdata.player_datas[0].avatar_id = 400101;
editdata.player_datas[1].avatar_id = 400101;
editdata.player_datas[2].avatar_id = 400101;
editdata.player_datas[3].avatar_id = 400101;
```

**下标 0, 1, 2, 3 表示开局时的座次("北起输一半"的起也是这个意思), 分别对应东, 南, 西, 北. 编辑每个对局中也是一样**

默认都设置为昵称为 `电脑` + 座次, 皮肤为一姬原皮

若要修改成其他角色, 请在控制台输入 `cfg.item_definition.skin.map_` 以选取 `avatar_id`, 或查阅 [字典](字典.md)

玩家信息可供修改的部分可见下面的 main.js 中对应的部分注释, 也可以自己阅读字典和products文件夹里面的预设进行研究,
或者阅读另一个仓库里面的文档: [牌谱里面到底记载了什么](https://github.com/Fat-pig-Cui/misc-code/tree/main/doc/%E7%89%8C%E8%B0%B1%E9%87%8C%E9%9D%A2%E5%88%B0%E5%BA%95%E8%AE%B0%E8%BD%BD%E4%BA%86%E4%BB%80%E4%B9%88)

```js
ret[seat] = {
    'account_id': x.player_datas[seat].avatar_id * 10 + seat, // 账号唯一id, 这里没什么用随便设的
    'seat': seat, // 座次
    'nickname': x.player_datas[seat].nickname, // 昵称
    'avatar_id': x.player_datas[seat].avatar_id, // 头像id
    'character': { // 角色信息
        'charid': cfg.item_definition.skin.map_[x.player_datas[seat].avatar_id].character_id, // 角色id
        'level': 5, // 角色好感等级, 即好感几颗心
        "exp": 0, // 好感经验, 契约之后值是0
        'skin': x.player_datas[seat].avatar_id, // 皮肤, 和 avatar_id 一样
        'is_upgraded': true, // 是否已契约
        'extra_emoji': [10, 11, 12] // 额外表情, 除了初始的九个外其他都是额外表情, 包括契约后的三个
    },
    'title': x.player_datas[seat].title, // 称号
    'level': {'id': 10503, 'score': 4500}, // 四麻段位分, 这里是圣三原点, 下同
    'level3': {'id': 20503, 'score': 4500}, // 三麻段位分
    'avatar_frame': x.player_datas[seat].avatar_frame, // 头像框
    'verified': x.player_datas[seat].verified, // 是否已认证
    'views': x.player_datas[seat].views, // 装扮槽
}
```

## 对局的模式 `editdata.config`

规则默认为段位场规则, 房间默认为"友人场四人东", 详情见注释和字典

```js
editdata.config = {
    'category': 2, // 1 表示友人场, 2 表示匹配场, 4 表示比赛场, 100 表示新手教程
    'meta': {'mode_id': 2}, // 只有在 category 为 2 时才有效
    // 2 表示铜四东, 3 表示铜四南, 详见 字典.md
    'mode': {
        'mode': 1, // 1 表示四人东, 2 表示四人南, 11 表示三人东, 12 表示三人南
        // 十位: 0 表示四麻, 1 表示三麻, 2 代表二人麻将(需要导入 add_function.js)
        // 个位: 1 表示东场, 2 表示半庄, 3 表示人机, 0和4 表示一局
        'detail_rule': { // 以下默认值为段位规则(除了指定数量的设定以外, 其他都默认 false)
            'tablecloth_id': uiscript.UI_Sushe.now_desktop_id, // 回放的桌布, 未设置时为原来的桌布 
            'mjp_id': uiscript.UI_Sushe.now_mjp_id, // 回放的牌背, 这个目前修改的不完美, 指示牌部分还是原来的, 未设置时为原来的牌背
            'mjpsurface_id': uiscript.UI_Sushe.now_mjp_surface_id, // 回放的牌面, 未设置时为原来的牌面
            'init_point': 25000, // 初始点数, 默认根据玩家数和模式自动选择
            'dora_count': 3, // 赤宝牌数量
            'fanfu': 1, // 番缚

            'huansanzhang': false, // 有无换三张部分(修罗, 赤羽)
            'xuezhandaodi': false, // 是否为血战到底模式(修罗之战)
            'chuanma': false, // 是否是赤羽之战模式
            'dora3_mode': false, // 是否为宝牌狂热模式
            'begin_open_mode': false, // 是否为配牌明牌模式
            'muyu_mode': false, // 是否为龙之目玉模式
            'jiuchao_mode': false, // 是否为明镜之战模式
            'reveal_discard': false, // 是否为暗夜之战模式
            'field_spell_mode': false, // 是否为幻境传说模式
            'zhanxing': false, // 是否为占星之战模式
            'tianming_mode': false, // 是否为天命之战模式
            'yongchang_mode': false, // 是否为咏唱之战模式
            'hunzhiyiji_mode': false, // 是否为魂之一击模式
            'wanxiangxiuluo_mode': false, // 是否为万象修罗模式
            'xueliu': false, // 是否为血流成河模式(自创模式, 需要导入 add_function.js)

            'guyi_mode': false, // 是否开启古役
            'yifanjieguyi': false, // 是否开启一番街的古役
            'no_shiduan': false, // 是否为无食断模式
            'no_zimosun': false, // 是否为无自摸损模式
            'open_hand': false, // 是否公开手牌

            'qieshangmanguan': false, // 有无切上满贯
            'toutiao': false, // 有无头跳, 即使在 hupai 函数中指定了多个玩家也会只有最靠近放铳位的玩家和牌
            'no_normalbaopai': false, // 是否无大三元大四喜包牌, 修罗模式强制无包牌
            'sigangbaopai': false, // 有无四杠子包牌, 修罗模式强制无包牌
            'no_liujumanguan': false, // 有无流局满贯
            'no_yifa': false, // 是否无一发
            'no_lianfengsifu': false, // 是否无连风4符
            'dora_jifan': false, // 明杠表宝牌是否即翻
            'sanxiangliuju': false, // 有无三家和了流局
            'no_leijiyiman': false, // 是否无累计役满
            'no_wyakuman': false, // 是否无双倍役满
            'no_guoshiangang': false, // 有无国士枪暗杠
            'baogang': false, // 有无包杠, 只适用于非修罗立直麻将
            
            'qingtianjing': false, // 是否为青天井模式(谨慎使用, 高打点时很容易崩溃, 并取消包牌)
            'no_zhenting': false, // 是否为无振听模式
            'ronghuzhahu': false, // 是否 hupai 无参数时无役荣和自动诈和, 详见 hupai 函数的讲解
            
            'guobiao': false, // 是否为国标模式
            'guobiao_no_8fanfu': false, // 国标模式是否无8番缚
            'guobiao_lianzhuang': false, // 国标模式是否可以连庄

            // 以下两种随机都是以每次查看为单位随机(即每次查看结果都不一样), 而不是以牌谱对局为单位随机
            'random_skin': false, // 是否随机角色, 以皮肤为最小单位随机, 开启此选项后设置的角色皮肤均无效
            'random_views': false, // 是否随机装扮, 范围包括立直棒, 和牌特效, 立直特效, 头像框, 桌布, 称号, 开启此选项后设置的对应装扮均无效
        }
    }
}
```

对于桌布, 牌背, 牌面的修改, 提供了两种方式:

1. 使用 `'detail_rule'` 中的 `'tablecloth_id'`, `'mjp_id'`, `'mjpsurface_id'`, 分别对应三种装扮
2. 使用东起(`seat` 为 0)的玩家的 `views`, `"slot"` 为 6, 7, 13 分别对应这三种装扮,

两种方式有冲突时, 以第一种方式为准

---

接下来就是切牌, 鸣牌相关的对局信息, 不过在开始前可以调用函数 `gamebegin()` 表示对局开始(可选)

## 编辑每个小局 (round)

开始 [编辑每个小局](编辑每个小局.md)

编辑结束后在最后调用函数 `gameend()` (非修罗和赤羽模式可以省略)

这样文件的编辑就结束了

## 输入到控制台

打开雀魂网址, 打开开发者工具, 选择 console

将 main.js 文件输入, 然后再将编辑好的自制回放文件输入

打开任意一个牌谱, 开始享用

## 清空与复原

清空: `loadproject();`
目前该仓库所有自制牌谱的开头都会有这个, 防止数据的叠加污染

复原(用于查看真实牌谱): `canceledit();`
注意这个函数不会清空自制牌谱的数据, 只是显示的内容重定向到了真实的牌谱
